<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø¬Ø¯ÙˆÙ„ Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù…ÙˆØ¸ÙØ§Øª</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200..1000&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" />
</head>

<body class="">
  <div class="p-3">
    <!-- Top row: buttons + counts -->
    <div class="flex flex-col md:flex-row justify-between gap-4 md:gap-0 mb-4">
      <!-- Buttons -->
      <div class="flex flex-wrap gap-3 md:gap-6 flex-1">
        <button id="printBtn" type="button"
          class="h-12 bg-gradient-to-br bg-blue-500 text-white rounded-lg px-3 shadow-sm font-bold transition cursor-pointer duration-300 hover:bg-blue-400 hover:shadow-lg flex items-center gap-2">
          Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„
          <i class="bi bi-printer"></i>
        </button>

        <button id="excelBtn" type="button"
          class="h-12 bg-gradient-to-br bg-cyan-500 text-white rounded-lg px-3 shadow-sm font-bold transition cursor-pointer duration-300 hover:bg-cyan-400 hover:shadow-lg flex items-center gap-2">
          ØªØµØ¯ÙŠØ± Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¥Ù„Ù‰ EXCEL
          <i class="bi bi-file-earmark-spreadsheet"></i>
        </button>

        <button id="deleteBtn" type="button"
          class="h-12 bg-gradient-to-br bg-red-500 text-white rounded-lg px-3 shadow-sm font-bold transition cursor-pointer duration-300 hover:bg-red-400 hover:shadow-lg flex items-center gap-2">
          Ø­Ø°Ù ÙƒØ§Ù…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          <i class="bi bi-trash3"></i>
        </button>
      </div>

      <!-- Counts -->
      <!-- <div
          class="w-full md:w-60 border border-gray-200 shadow-lg p-3 rounded-xl mt-3 md:mt-0"
        >
          <div id="doneCount">ğŸŸ¢ ØªÙ… Ø¥Ù†Ø¬Ø§Ø²Ù‡: 0</div>
          <div id="notDoneCount">ğŸ”´ Ù„Ù… ÙŠØªÙ… Ø¥Ù†Ø¬Ø§Ø²Ù‡: 0</div>
        </div> -->
    </div>

    <!-- Table -->
    <div class="overflow-x-auto rounded shadow">
      <table id="employeeTable" class="min-w-full border border-gray-300 text-right">
        <thead class="bg-gray-100">
          <tr>
            <th class="text-center text-xs border px-4 py-2">Ù…</th>
            <th class="text-center text-xs border px-4 py-2 w-[100px]">Ø§Ù„ÙØµÙ„</th>
            <th class="text-center text-xs border px-4 py-2">Ø§Ù„ÙØ±ÙŠÙ‚</th>
            <th class="text-center text-xs border px-4 py-2">Ø§Ù„Ù…Ø´Ø±ÙØ©</th>
            <th class="text-center text-xs border px-4 py-2 w-[95px]">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th class="text-center text-xs border px-4 py-2 w-[45px]">Ø§Ù„ÙŠÙˆÙ…</th>
            <!-- <th class="text-center text-xs border px-4 py-2 w-[60px]">Ø§Ù„Ù„Ø¬Ù†Ø©</th> -->
            <!-- <th class="text-center text-xs border px-4 py-2">Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th> -->
            <th class="text-center text-xs border px-4 py-2">Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</th>
            <th class="text-center text-xs border px-4 py-2">Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th>
            <th class="text-center text-xs border px-4 py-2">Ø§Ù„Ù…Ø¬Ø§Ù„</th>
            <th class="text-center text-xs border px-4 py-2 w-[200px]">Ù…Ø¤Ø´Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡</th>
            <th class="text-center text-xs border px-4 py-2 w-[130px]">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            <th class="text-center text-xs border px-4 py-2 w-[100px]">Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</th>
            <th class="text-center text-xs border px-4 py-2 w-[100px]">Ø§Ù„Ø´Ø§Ù‡Ø¯</th>
            <th class="text-center text-xs border px-4 py-2"> </th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù‡Ù†Ø§ -->
        </tbody>
      </table>
    </div>
  </div>
  <script src="../utils/findDay.js"></script>
  <script src="buttonsFunctions.js"></script>
  <script src="scopeJson.js"></script>
  <script>
    // function updateCounts() {
    //   const data = JSON.parse(localStorage.getItem("employeeData") || "[]");

    //   // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© ÙˆØºÙŠØ± Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©
    //   const done = data.filter((item) => item.category == "1").length;
    //   const notDone = data.filter((item) => item.category == "2").length;

    //   // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
    //   document.getElementById(
    //     "doneCount"
    //   ).textContent = `ğŸŸ¢ ØªÙ… Ø¥Ù†Ø¬Ø§Ø²Ù‡: ${done}`;
    //   document.getElementById(
    //     "notDoneCount"
    //   ).textContent = `ğŸ”´  Ù„Ù… ÙŠØªÙ… Ø¥Ù†Ø¬Ø§Ø²Ù‡: ${notDone}`;
    // }

    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    // window.addEventListener("DOMContentLoaded", updateCounts);

    function loadTable() {
      const tableBody = document.getElementById("tableBody");
      tableBody.innerHTML = ""; // Ù…Ø³Ø­ Ø£ÙŠ Ù…Ø­ØªÙˆÙ‰ Ù‚Ø¯ÙŠÙ…

      const data = JSON.parse(localStorage.getItem("excellenceReport") || "[]");
      console.log(data)

      data.forEach((item, index) => {
        const row = document.createElement("tr");
        row.className = "hover:bg-gray-50";
        var scope = scopeJson.find(f => f.scopeId == item.scope);
        var pIx = 0
        var mIx = 0

        // ${item.stage == "1" ? "Ø·ÙÙˆÙ„Ø© Ù…Ø¨ÙƒØ±Ø©" : ""}
        //${item.stage == "2" ? "Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ" : ""}
        //${item.stage == "3" ? "Ù…ØªÙˆØ³Ø·" : ""}
        //${item.stage == "4" ? "Ø«Ø§Ù†ÙˆÙŠ" : ""}
        // ${item.job}

        row.innerHTML = `
                <td class="text-xs border px-4 py-2">${index + 1}</td>
                <td class="text-xs border px-4 py-2">${item.term == "1" ? "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„" : "Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ"}</td>
                <td class="text-xs border px-4 py-2">${item.team}</td>
                <td class="text-xs border px-4 py-2">
                  ${item.advisorName}
                  </td>
                <td class="text-xs border px-4 py-2"> ${item.date}</td>
                <td class="text-xs border px-4 py-2">
                  ${findDay(item.date)}
                  </td>
                <td class="text-xs border px-4 py-2">${item.school}</td>
                <td class="text-xs border px-4 py-2">
        ${item.stage == "1" ? "Ø·ÙÙˆÙ„Ø© Ù…Ø¨ÙƒØ±Ø©" : ""}
        ${item.stage == "2" ? "Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ" : ""}
        ${item.stage == "3" ? "Ù…ØªÙˆØ³Ø·" : ""}
        ${item.stage == "4" ? "Ø«Ø§Ù†ÙˆÙŠ" : ""}
                  </td>
                <td class="text-xs border px-4 py-2 text-center">
                  ${item.scope.map((s, i) => {

          var scope = scopeJson.find(f => f.scopeId == s);
          return `<p>${i + 1}. ${scope.label}</p>`;

        }).join("")}
                  </td>
                <td class="text-xs border px-4 py-2 text-start">
                  ${item.pointer.map((p, i) => {
          if (p == "add") {
            pIx += 1;
            return `<p>${i + 1}. ${item.newPointer[pIx - 1]}</p>`;
          } else {
            // var pointer = scope.pointer.find(f => f.pointerId == p);
            var pointer = pointerJson.find(f => f.pointerId == p);
            return `<p>${i + 1}. ${pointer.label}</p>`;
          }
        }).join("")}
                </td>
                <td class="text-xs border px-4 py-2 text-start">
                  ${item.method.map((m, i) => {

          if (m == "add") {
            mIx += 1;
            return `<p>${i + 1}. ${item.newMethod[mIx - 1]}</p>`
          } else {
            var method = methodJson.find(f => f.methodId == m);
            return `<p>${i + 1}. ${method.label}</p>`;
          }
        }).join("")}
                </td>
                <td class="text-xs border text-xs px-2">${item.category == "1" ? "ğŸŸ¢ ØªÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²" : "ğŸ”´ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²"}</td>
                <td class="text-xs border text-xs px-2">
                  ${item.barcodeImage
            ? `<img src="${item.barcodeImage}" alt="barcode" class="w-16 h-16 mx-auto"/>`
            : ""
          }
                  </td>
                  <td class="text-xs border px-4 py-2 text-center">
                    <button class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded delete-btn">
                        Ø­Ø°Ù
                        <i class="bi bi-trash3"></i>
                    </button>
                    </td>
            `;

        // Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø²Ø± Ø§Ù„Ø­Ø°Ù
        row.querySelector(".delete-btn").addEventListener("click", () => {
          if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) {
            data.splice(index, 1); // Ø­Ø°Ù Ù…Ù† Ø§Ù„Ù…ØµÙÙˆÙØ©
            localStorage.setItem("excellenceReport", JSON.stringify(data)); // ØªØ­Ø¯ÙŠØ« localStorage
            loadTable(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            updateCounts();
          }
        });

        tableBody.appendChild(row);
      });
    }
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    window.addEventListener("DOMContentLoaded", loadTable);
  </script>
</body>

</html>